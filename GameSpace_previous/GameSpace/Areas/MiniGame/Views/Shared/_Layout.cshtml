<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no" />
    <meta name="description" content="GameSpace 小遊戲區域 - 寵物養成、每日簽到、錢包管理" />
    <meta name="theme-color" content="#0d6efd" />
    <title>@ViewData["Title"] - 小遊戲區域</title>
    
    <!-- 預載入關鍵資源 -->
    <link rel="preload" href="~/lib/bootstrap/dist/css/bootstrap.min.css" as="style" />
    <link rel="preload" href="~/lib/jquery/dist/jquery.min.js" as="script" />
    
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    
    <!-- MiniGame 區域專用 CSS -->
    <style>
        :root {
            --minigame-primary: #0d6efd;
            --minigame-success: #198754;
            --minigame-warning: #ffc107;
            --minigame-danger: #dc3545;
            --minigame-bg-light: #f8f9fa;
            --minigame-shadow: 0 2px 4px rgba(0,0,0,0.1);
            --minigame-border-radius: 0.375rem;
            --minigame-transition: all 0.3s ease;
        }
        
        /* 響應式容器優化 */
        .container-fluid {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* 載入狀態指示器 */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255,255,255,0.9);
            display: none;
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }
        
        .loading-spinner {
            width: 3rem;
            height: 3rem;
        }
        
        /* 無障礙性改進 */
        .sr-only {
            position: absolute !important;
            width: 1px !important;
            height: 1px !important;
            padding: 0 !important;
            margin: -1px !important;
            overflow: hidden !important;
            clip: rect(0,0,0,0) !important;
            border: 0 !important;
        }
        
        /* 聚焦指示器增強 */
        .btn:focus, .form-control:focus, .form-select:focus {
            box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
            border-color: var(--minigame-primary);
        }
        
        /* 卡片懸停效果優化 */
        .card {
            transition: var(--minigame-transition);
        }
        
        .card:hover {
            box-shadow: var(--minigame-shadow);
            transform: translateY(-2px);
        }
        
        /* 小螢幕優化 */
        @media (max-width: 576px) {
            .container-fluid {
                padding-left: 10px;
                padding-right: 10px;
            }
            
            .card-body {
                padding: 1rem 0.75rem;
            }
            
            .btn-group .btn {
                font-size: 0.875rem;
                padding: 0.375rem 0.5rem;
            }
            
            h2 {
                font-size: 1.5rem;
            }
            
            h3 {
                font-size: 1.25rem;
            }
        }
        
        /* 中型螢幕優化 */
        @media (min-width: 577px) and (max-width: 992px) {
            .card-body {
                padding: 1.25rem;
            }
        }
        
        /* 高對比模式支援 */
        @media (prefers-contrast: high) {
            .card {
                border-width: 2px;
            }
            
            .btn {
                border-width: 2px;
            }
        }
        
        /* 減少動畫偏好支援 */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <!-- 跳過導航連結（無障礙性） -->
    <a href="#main-content" class="sr-only sr-only-focusable btn btn-primary">跳至主要內容</a>
    
    <!-- 載入指示器 -->
    <div class="loading-overlay" id="loadingOverlay" aria-hidden="true">
        <div class="text-center">
            <div class="spinner-border loading-spinner text-primary" role="status">
                <span class="sr-only">載入中...</span>
            </div>
            <div class="mt-3">
                <small class="text-muted">載入中，請稍候...</small>
            </div>
        </div>
    </div>
    
    <header role="banner">
        @await Html.PartialAsync("_TopbarLevel1")
    </header>
    
    <!-- 主要內容區域 -->
    <div class="container-fluid">
        <main id="main-content" role="main" class="pb-3" tabindex="-1">
            <!-- 訊息顯示區域 -->
            @if (TempData["SuccessMessage"] != null)
            {
                <div class="alert alert-success alert-dismissible fade show mt-3" role="alert" aria-live="polite">
                    <i class="fas fa-check-circle me-2" aria-hidden="true"></i>
                    @TempData["SuccessMessage"]
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="關閉訊息"></button>
                </div>
            }
            
            @if (TempData["ErrorMessage"] != null)
            {
                <div class="alert alert-danger alert-dismissible fade show mt-3" role="alert" aria-live="assertive">
                    <i class="fas fa-exclamation-triangle me-2" aria-hidden="true"></i>
                    @TempData["ErrorMessage"]
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="關閉錯誤訊息"></button>
                </div>
            }
            
            @if (TempData["InfoMessage"] != null)
            {
                <div class="alert alert-info alert-dismissible fade show mt-3" role="alert" aria-live="polite">
                    <i class="fas fa-info-circle me-2" aria-hidden="true"></i>
                    @TempData["InfoMessage"]
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="關閉資訊"></button>
                </div>
            }
            
            @RenderBody()
        </main>
    </div>

    <footer class="border-top footer text-muted mt-5" role="contentinfo">
        <div class="container">
            <div class="row py-3">
                <div class="col-md-6">
                    <small>&copy; 2024 - GameSpace 小遊戲區域</small>
                </div>
                <div class="col-md-6 text-md-end">
                    <small>
                        <a href="#" class="text-muted text-decoration-none">隱私權政策</a>
                        <span class="mx-2">|</span>
                        <a href="#" class="text-muted text-decoration-none">服務條款</a>
                        <span class="mx-2">|</span>
                        <a href="#" class="text-muted text-decoration-none">意見反饋</a>
                    </small>
                </div>
            </div>
        </div>
    </footer>
    
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    
    <!-- MiniGame 區域通用 JavaScript -->
    <script>
        // 全域載入指示器控制
        window.showLoading = function() {
            document.getElementById('loadingOverlay').style.display = 'flex';
        };
        
        window.hideLoading = function() {
            document.getElementById('loadingOverlay').style.display = 'none';
        };
        
        // AJAX 請求攔截器 - 自動顯示載入指示器
        $(document).ajaxStart(function() {
            showLoading();
        }).ajaxStop(function() {
            hideLoading();
        });
        
        // 表單提交載入指示器
        $('form').on('submit', function() {
            showLoading();
        });
        
        // 鍵盤導航支援
        $(document).on('keydown', function(e) {
            // ESC 鍵關閉模態對話框
            if (e.key === 'Escape') {
                $('.modal.show').modal('hide');
            }
        });
        
        // 自動隱藏警告訊息
        setTimeout(function() {
            $('.alert').fadeOut('slow');
        }, 5000);
        
        // 無障礙性改進 - 聚焦管理
        $('.modal').on('shown.bs.modal', function() {
            $(this).find('input, select, textarea, button').first().focus();
        });
        
        // 回到頂端按鈕（響應式）
        $(window).scroll(function() {
            if ($(window).scrollTop() > 300) {
                $('#backToTop').fadeIn();
            } else {
                $('#backToTop').fadeOut();
            }
        });
        
        $('#backToTop').click(function() {
            $('html, body').animate({scrollTop: 0}, 500);
            return false;
        });
        
        // 觸摸設備優化
        if ('ontouchstart' in window) {
            $('body').addClass('touch-device');
        }
    </script>
    
    @await RenderSectionAsync("Scripts", required: false)
    
    <!-- 回到頂端按鈕 -->
    <button id="backToTop" class="btn btn-primary position-fixed" 
            style="bottom: 20px; right: 20px; z-index: 1000; display: none; border-radius: 50%; width: 50px; height: 50px;"
            aria-label="回到頁面頂端">
        <i class="fas fa-arrow-up" aria-hidden="true"></i>
    </button>
</body>
</html>