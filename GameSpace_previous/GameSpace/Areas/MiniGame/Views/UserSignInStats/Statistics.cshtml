@model GameSpace.Areas.MiniGame.Models.SignInStatsDisplayViewModel
@{
    ViewData["Title"] = "簽到統計";
}

<div class="container-fluid py-4">
    <div class="row">
        <div class="col-12">
            <h2 class="mb-4">@ViewData["Title"]</h2>
            
            <!-- 返回按鈕 -->
            <div class="mb-3">
                <a asp-action="Index" class="btn btn-outline-secondary">
                    <i class="fas fa-arrow-left me-2"></i>返回簽到頁面
                </a>
            </div>
        </div>
    </div>

    <!-- 統計概覽卡片 -->
    <div class="row mb-4">
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="card text-center border-success">
                <div class="card-body">
                    <i class="fas fa-fire fa-3x text-success mb-3"></i>
                    <h5 class="card-title">連續天數</h5>
                    <h3 class="text-success">@Model.ConsecutiveDays 天</h3>
                    <small class="text-muted">目前紀錄</small>
                </div>
            </div>
        </div>
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="card text-center border-primary">
                <div class="card-body">
                    <i class="fas fa-calendar-check fa-3x text-primary mb-3"></i>
                    <h5 class="card-title">本月簽到</h5>
                    <h3 class="text-primary">@Model.MonthlySignInDays 天</h3>
                    <small class="text-muted">共 @DateTime.Now.Day 天</small>
                </div>
            </div>
        </div>
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="card text-center border-info">
                <div class="card-body">
                    <i class="fas fa-coins fa-3x text-info mb-3"></i>
                    <h5 class="card-title">本月積分</h5>
                    <h3 class="text-info">@Model.MonthlyPointsEarned</h3>
                    <small class="text-muted">簽到獲得</small>
                </div>
            </div>
        </div>
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="card text-center border-warning">
                <div class="card-body">
                    <i class="fas fa-star fa-3x text-warning mb-3"></i>
                    <h5 class="card-title">總計天數</h5>
                    <h3 class="text-warning">@Model.TotalSignInDays</h3>
                    <small class="text-muted">累計紀錄</small>
                </div>
            </div>
        </div>
    </div>

    <!-- 詳細統計表格 -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">簽到歷史詳細記錄</h5>
                    <div>
                        <button class="btn btn-sm btn-outline-primary" id="exportStatsBtn">
                            <i class="fas fa-download me-1"></i>匯出統計
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th>紀錄編號</th>
                                    <th>簽到日期</th>
                                    <th>簽到時間</th>
                                    <th>獲得積分</th>
                                    <th>獲得經驗</th>
                                    <th>獎勵優惠券</th>
                                    <th>連續天數</th>
                                </tr>
                            </thead>
                            <tbody>
                                @if (Model.RecentSignInStats.Any())
                                {
                                    @foreach (var (stats, index) in Model.RecentSignInStats.Select((s, i) => (s, i)))
                                    {
                                        <tr>
                                            <td>
                                                <small class="text-muted">LOG</small>
                                                <strong>@stats.LogID.ToString("000000")</strong>
                                            </td>
                                            <td>@stats.SignTime.ToString("yyyy/MM/dd")</td>
                                            <td>@stats.SignTime.ToString("HH:mm:ss")</td>
                                            <td>
                                                <span class="badge bg-success">+@stats.PointsGained</span>
                                            </td>
                                            <td>
                                                <span class="badge bg-info">+@stats.ExpGained</span>
                                            </td>
                                            <td>
                                                @if (!string.IsNullOrEmpty(stats.CouponGained))
                                                {
                                                    <span class="badge bg-warning">@stats.CouponGained</span>
                                                }
                                                else
                                                {
                                                    <span class="text-muted">-</span>
                                                }
                                            </td>
                                            <td>
                                                <span class="text-primary">@(Model.ConsecutiveDays - index) 天</span>
                                            </td>
                                        </tr>
                                    }
                                }
                                else
                                {
                                    <tr>
                                        <td colspan="7" class="text-center py-5">
                                            <i class="fas fa-calendar fa-3x text-muted mb-3"></i>
                                            <h5 class="text-muted">目前沒有簽到記錄</h5>
                                            <p class="text-muted">開始每日簽到來累積獎勵</p>
                                            <a asp-action="Index" class="btn btn-primary">
                                                <i class="fas fa-hand-paper me-2"></i>立即簽到
                                            </a>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 成就與里程碑 -->
    <div class="row">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">簽到成就</h5>
                </div>
                <div class="card-body">
                    <div class="achievement-list">
                        @{
                            var achievements = new[]
                            {
                                new { Name = "新手簽到", Description = "連續簽到 3 天", Target = 3, Current = Math.Min(Model.ConsecutiveDays, 3), Completed = Model.ConsecutiveDays >= 3 },
                                new { Name = "簽到達人", Description = "連續簽到 7 天", Target = 7, Current = Math.Min(Model.ConsecutiveDays, 7), Completed = Model.ConsecutiveDays >= 7 },
                                new { Name = "簽到專家", Description = "連續簽到 30 天", Target = 30, Current = Math.Min(Model.ConsecutiveDays, 30), Completed = Model.ConsecutiveDays >= 30 },
                                new { Name = "簽到大師", Description = "連續簽到 100 天", Target = 100, Current = Math.Min(Model.ConsecutiveDays, 100), Completed = Model.ConsecutiveDays >= 100 }
                            };
                        }
                        
                        @foreach (var achievement in achievements)
                        {
                            <div class="achievement-item mb-3">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div class="d-flex align-items-center">
                                        @if (achievement.Completed)
                                        {
                                            <i class="fas fa-trophy text-warning me-3 fa-lg"></i>
                                        }
                                        else
                                        {
                                            <i class="far fa-circle text-muted me-3 fa-lg"></i>
                                        }
                                        <div>
                                            <h6 class="mb-1 @(achievement.Completed ? "text-warning" : "")">@achievement.Name</h6>
                                            <small class="text-muted">@achievement.Description</small>
                                        </div>
                                    </div>
                                    <div class="text-end">
                                        <small class="text-muted">@achievement.Current / @achievement.Target</small>
                                        <div class="progress mt-1" style="width: 80px; height: 8px;">
                                            <div class="progress-bar @(achievement.Completed ? "bg-warning" : "bg-primary")" 
                                                 style="width: @((double)achievement.Current / achievement.Target * 100)%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">下週預測</h5>
                </div>
                <div class="card-body">
                    <div class="prediction-info">
                        <div class="mb-3">
                            <h6>基於目前習慣預測</h6>
                            <p class="text-muted">根據您最近的簽到模式分析</p>
                        </div>
                        
                        <div class="row text-center">
                            <div class="col-6 mb-3">
                                <div class="text-muted">預估簽到天數</div>
                                <h4 class="text-primary">6-7 天</h4>
                            </div>
                            <div class="col-6 mb-3">
                                <div class="text-muted">預估獲得積分</div>
                                <h4 class="text-success">@((int)(Model.TodayPointsReward * 6.5))</h4>
                            </div>
                        </div>
                        
                        <div class="alert alert-info">
                            <small>
                                <i class="fas fa-info-circle me-2"></i>
                                保持每日簽到習慣，可以獲得更多獎勵與成就！
                            </small>
                        </div>
                        
                        <div class="text-center mt-3">
                            <a asp-action="Index" class="btn btn-primary">
                                <i class="fas fa-hand-paper me-2"></i>立即簽到
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.achievement-item {
    border-left: 4px solid transparent;
    padding-left: 10px;
    transition: all 0.3s ease;
}

.achievement-item:hover {
    background-color: #f8f9fa;
    border-left-color: #0d6efd;
}

.achievement-item .fa-trophy {
    filter: drop-shadow(0 0 4px rgba(255,193,7,0.3));
}

.prediction-info {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    padding: 20px;
    border-radius: 10px;
    border: 1px solid #dee2e6;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const exportBtn = document.getElementById('exportStatsBtn');
    
    exportBtn.addEventListener('click', function() {
        // 匯出統計邏輯將在 Stage 4 實作
        alert('簽到統計匯出功能將在後續版本實作');
    });
    
    // 成就動畫效果
    const achievements = document.querySelectorAll('.achievement-item');
    achievements.forEach((item, index) => {
        item.style.animationDelay = `${index * 0.1}s`;
        item.classList.add('fade-in');
    });
});
</script>