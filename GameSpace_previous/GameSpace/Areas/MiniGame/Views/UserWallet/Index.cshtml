@model GameSpace.Areas.MiniGame.Models.WalletOverviewDisplayViewModel
@{
    ViewData["Title"] = "我的錢包";
}

<div class="container-fluid py-4">
    <!-- 頁面標題與導航提示 -->
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1 class="h2 mb-0">@ViewData["Title"]</h1>
                <nav aria-label="頁面導航">
                    <ol class="breadcrumb mb-0">
                        <li class="breadcrumb-item">
                            <a asp-area="MiniGame" asp-controller="Home" asp-action="Index">小遊戲首頁</a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">我的錢包</li>
                    </ol>
                </nav>
            </div>
        </div>
    </div>

    <!-- 錢包概覽卡片 - 響應式網格 -->
    <div class="row" role="region" aria-label="錢包統計概覽">
        <div class="col-lg-3 col-md-6 col-sm-6 mb-4">
            <div class="card text-center h-100" tabindex="0">
                <div class="card-body">
                    <div class="mb-3">
                        <i class="fas fa-coins fa-2x text-primary" aria-hidden="true"></i>
                    </div>
                    <h2 class="h5 card-title">目前積分</h2>
                    <p class="h3 text-primary mb-2" aria-label="積分數量：@Model.CurrentPoints.ToString("N0") 點">
                        @Model.CurrentPoints.ToString("N0")
                    </p>
                    <small class="card-text text-muted">可用於兌換獎品</small>
                </div>
            </div>
        </div>
        
        <div class="col-lg-3 col-md-6 col-sm-6 mb-4">
            <div class="card text-center h-100" tabindex="0">
                <div class="card-body">
                    <div class="mb-3">
                        <i class="fas fa-ticket-alt fa-2x text-success" aria-hidden="true"></i>
                    </div>
                    <h2 class="h5 card-title">可用優惠券</h2>
                    <p class="h3 text-success mb-2" aria-label="可用優惠券數量：@Model.AvailableCouponsCount 張">
                        @Model.AvailableCouponsCount
                    </p>
                    <small class="card-text text-muted">尚未使用的優惠券</small>
                </div>
            </div>
        </div>
        
        <div class="col-lg-3 col-md-6 col-sm-6 mb-4">
            <div class="card text-center h-100" tabindex="0">
                <div class="card-body">
                    <div class="mb-3">
                        <i class="fas fa-gift fa-2x text-warning" aria-hidden="true"></i>
                    </div>
                    <h2 class="h5 card-title">電子禮券</h2>
                    <p class="h3 text-warning mb-2" aria-label="電子禮券數量：@Model.AvailableEVouchersCount 張">
                        @Model.AvailableEVouchersCount
                    </p>
                    <small class="card-text text-muted">可兌換的電子禮券</small>
                </div>
            </div>
        </div>
        
        <div class="col-lg-3 col-md-6 col-sm-6 mb-4">
            <div class="card text-center h-100" tabindex="0">
                <div class="card-body">
                    <div class="mb-3">
                        <i class="fas fa-chart-line fa-2x text-info" aria-hidden="true"></i>
                    </div>
                    <h2 class="h5 card-title">本月消費</h2>
                    <p class="h3 text-info mb-2" aria-label="本月積分消費：@Model.MonthlyPointsSpent.ToString("N0") 點">
                        @Model.MonthlyPointsSpent.ToString("N0")
                    </p>
                    <small class="card-text text-muted">積分消費統計</small>
                </div>
            </div>
        </div>
    </div>

    <!-- 快速操作按鈕 - 響應式設計 -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h2 class="h5 mb-0">快速操作</h2>
                </div>
                <div class="card-body">
                    <!-- 大螢幕：按鈕群組 -->
                    <div class="d-none d-md-block">
                        <div class="btn-group w-100" role="group" aria-label="錢包功能快速操作">
                            <a asp-action="Points" class="btn btn-outline-primary" role="button">
                                <i class="fas fa-coins me-2" aria-hidden="true"></i>積分明細
                            </a>
                            <a asp-action="Coupons" class="btn btn-outline-success" role="button">
                                <i class="fas fa-ticket-alt me-2" aria-hidden="true"></i>我的優惠券
                            </a>
                            <a asp-action="EVouchers" class="btn btn-outline-warning" role="button">
                                <i class="fas fa-gift me-2" aria-hidden="true"></i>電子禮券
                            </a>
                            <a asp-action="History" class="btn btn-outline-info" role="button">
                                <i class="fas fa-history me-2" aria-hidden="true"></i>交易記錄
                            </a>
                        </div>
                    </div>
                    
                    <!-- 小螢幕：網格佈局 -->
                    <div class="d-md-none">
                        <div class="row">
                            <div class="col-6 mb-2">
                                <a asp-action="Points" class="btn btn-outline-primary w-100" role="button">
                                    <i class="fas fa-coins d-block mb-1" aria-hidden="true"></i>
                                    <small>積分明細</small>
                                </a>
                            </div>
                            <div class="col-6 mb-2">
                                <a asp-action="Coupons" class="btn btn-outline-success w-100" role="button">
                                    <i class="fas fa-ticket-alt d-block mb-1" aria-hidden="true"></i>
                                    <small>優惠券</small>
                                </a>
                            </div>
                            <div class="col-6 mb-2">
                                <a asp-action="EVouchers" class="btn btn-outline-warning w-100" role="button">
                                    <i class="fas fa-gift d-block mb-1" aria-hidden="true"></i>
                                    <small>電子禮券</small>
                                </a>
                            </div>
                            <div class="col-6 mb-2">
                                <a asp-action="History" class="btn btn-outline-info w-100" role="button">
                                    <i class="fas fa-history d-block mb-1" aria-hidden="true"></i>
                                    <small>交易記錄</small>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 最近交易紀錄 - 響應式表格 -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h2 class="h5 mb-0">最近交易</h2>
                    <span class="badge bg-secondary" aria-label="交易記錄數量">
                        @Model.RecentTransactions.Count 筆記錄
                    </span>
                </div>
                <div class="card-body">
                    @if (Model.RecentTransactions.Any())
                    {
                        <!-- 大螢幕：完整表格 -->
                        <div class="d-none d-md-block">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover" role="table" aria-label="最近交易記錄表格">
                                    <thead class="table-light">
                                        <tr>
                                            <th scope="col">日期時間</th>
                                            <th scope="col">交易類型</th>
                                            <th scope="col">積分變動</th>
                                            <th scope="col">交易說明</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var transaction in Model.RecentTransactions)
                                        {
                                            <tr>
                                                <td>
                                                    <time datetime="@transaction.ChangeTime.ToString("yyyy-MM-ddTHH:mm:ss")">
                                                        @transaction.ChangeTime.ToString("yyyy/MM/dd HH:mm")
                                                    </time>
                                                </td>
                                                <td>
                                                    @if (transaction.PointsChanged > 0)
                                                    {
                                                        <span class="badge bg-success" aria-label="積分獲得交易">
                                                            <i class="fas fa-plus me-1" aria-hidden="true"></i>@transaction.ChangeType
                                                        </span>
                                                    }
                                                    else
                                                    {
                                                        <span class="badge bg-warning" aria-label="積分消費交易">
                                                            <i class="fas fa-minus me-1" aria-hidden="true"></i>@transaction.ChangeType
                                                        </span>
                                                    }
                                                </td>
                                                <td>
                                                    <strong class="@(transaction.PointsChanged > 0 ? "text-success" : "text-danger")" 
                                                            aria-label="積分變動：@(transaction.PointsChanged > 0 ? "增加" : "減少") @Math.Abs(transaction.PointsChanged) 點">
                                                        @(transaction.PointsChanged > 0 ? "+" : "")@transaction.PointsChanged.ToString("N0")
                                                    </strong>
                                                </td>
                                                <td>@transaction.Description</td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- 小螢幕：卡片列表 -->
                        <div class="d-md-none">
                            @foreach (var (transaction, index) in Model.RecentTransactions.Select((t, i) => (t, i)))
                            {
                                <div class="card mb-3 border-start border-3 @(transaction.PointsChanged > 0 ? "border-success" : "border-warning")">
                                    <div class="card-body py-2">
                                        <div class="d-flex justify-content-between align-items-start">
                                            <div>
                                                <h3 class="h6 mb-1">@transaction.Description</h3>
                                                <small class="text-muted">
                                                    <time datetime="@transaction.ChangeTime.ToString("yyyy-MM-ddTHH:mm:ss")">
                                                        @transaction.ChangeTime.ToString("MM/dd HH:mm")
                                                    </time>
                                                </small>
                                            </div>
                                            <div class="text-end">
                                                <div class="@(transaction.PointsChanged > 0 ? "text-success" : "text-danger") fw-bold">
                                                    @(transaction.PointsChanged > 0 ? "+" : "")@transaction.PointsChanged.ToString("N0")
                                                </div>
                                                <small class="badge bg-@(transaction.PointsChanged > 0 ? "success" : "warning")">
                                                    @transaction.ChangeType
                                                </small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    }
                    else
                    {
                        <div class="text-center py-5" role="status" aria-live="polite">
                            <i class="fas fa-receipt fa-3x text-muted mb-3" aria-hidden="true"></i>
                            <h3 class="h5 text-muted">目前沒有交易記錄</h3>
                            <p class="text-muted">開始使用積分功能來查看交易歷史</p>
                            <a asp-area="MiniGame" asp-controller="Game" asp-action="Index" class="btn btn-primary">
                                <i class="fas fa-gamepad me-2" aria-hidden="true"></i>前往遊戲大廳
                            </a>
                        </div>
                    }
                    
                    <div class="text-center mt-3">
                        <a asp-action="History" class="btn btn-outline-secondary" role="button">
                            <i class="fas fa-list me-2" aria-hidden="true"></i>查看全部記錄
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>