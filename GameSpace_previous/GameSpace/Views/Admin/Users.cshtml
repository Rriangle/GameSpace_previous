@model IEnumerable<GameSpace.Models.Users>
@{
    ViewData["Title"] = "用戶管理 - GameSpace";
    Layout = "_Layout";
    var totalPages = (int)ViewBag.TotalPages;
    var currentPage = (int)ViewBag.CurrentPage;
}

<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>用戶管理 - GameSpace</title>
    <style>
        :root{
            --bg:#f8fafc; --bg2:#ffffff; --ink:#1f2937; --muted:#64748b; --line:#e5e7eb;
            --surface:rgba(255,255,255,.75); --glass:rgba(255,255,255,.45);
            --accent:#3b82f6; --accent-2:#10b981; --accent-3:#f59e0b; --accent-4:#ef4444;
            --radius:12px; --radius-sm:8px; --shadow:0 4px 6px rgba(0,0,0,.1);
        }
        *{box-sizing:border-box} html,body{height:100%}
        body{
            margin:0; color:var(--ink); font:14px/1.5 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans TC","PingFang TC","Microsoft JhengHei",sans-serif;
            background:var(--bg);
        }
        .wrap{max-width:1400px; margin:0 auto; padding:20px}
        
        /* 標題 */
        .page-title{
            font-size:28px; font-weight:700; color:var(--ink); margin-bottom:30px;
            display:flex; align-items:center; gap:15px;
        }
        
        /* 搜索和篩選 */
        .filters{
            background:var(--bg2); border:1px solid var(--line); border-radius:var(--radius);
            padding:20px; margin-bottom:20px; box-shadow:var(--shadow);
        }
        .filter-row{
            display:flex; gap:15px; align-items:center; flex-wrap:wrap;
        }
        .filter-group{
            display:flex; flex-direction:column; gap:5px;
        }
        .filter-label{
            font-size:12px; font-weight:600; color:var(--muted); text-transform:uppercase;
        }
        .filter-input{
            padding:8px 12px; border:1px solid var(--line); border-radius:var(--radius-sm);
            font-size:14px; background:var(--bg2);
        }
        .btn{
            padding:8px 16px; border:none; border-radius:var(--radius-sm); font-weight:600;
            cursor:pointer; transition:all 0.3s ease; text-decoration:none; display:inline-block;
        }
        .btn-primary{
            background:var(--accent); color:#fff;
        }
        .btn-primary:hover{background:#2563eb}
        .btn-secondary{
            background:var(--surface); color:var(--ink); border:1px solid var(--line);
        }
        .btn-secondary:hover{background:var(--line)}
        
        /* 表格 */
        .table-container{
            background:var(--bg2); border:1px solid var(--line); border-radius:var(--radius);
            overflow:hidden; box-shadow:var(--shadow);
        }
        .table{
            width:100%; border-collapse:collapse; font-size:14px;
        }
        .table th{
            background:var(--surface); padding:15px; text-align:left; font-weight:600;
            color:var(--ink); border-bottom:1px solid var(--line);
        }
        .table td{
            padding:15px; border-bottom:1px solid var(--line);
        }
        .table tbody tr:hover{
            background:var(--surface);
        }
        
        /* 狀態標籤 */
        .status-badge{
            padding:4px 8px; border-radius:12px; font-size:12px; font-weight:600;
            text-transform:uppercase;
        }
        .status-active{
            background:#dcfce7; color:#166534;
        }
        .status-banned{
            background:#fef2f2; color:#dc2626;
        }
        .status-pending{
            background:#fef3c7; color:#d97706;
        }
        
        /* 分頁 */
        .pagination{
            display:flex; justify-content:center; align-items:center; gap:10px;
            margin-top:20px;
        }
        .page-btn{
            padding:8px 12px; border:1px solid var(--line); border-radius:var(--radius-sm);
            background:var(--bg2); color:var(--ink); text-decoration:none; font-weight:600;
        }
        .page-btn:hover{
            background:var(--accent); color:#fff; border-color:var(--accent);
        }
        .page-btn.active{
            background:var(--accent); color:#fff; border-color:var(--accent);
        }
        .page-btn:disabled{
            opacity:0.5; cursor:not-allowed;
        }
        
        /* 空狀態 */
        .empty-state{
            text-align:center; padding:60px 20px; color:var(--muted);
        }
        .empty-icon{font-size:48px; margin-bottom:20px}
        .empty-title{font-size:18px; font-weight:600; margin-bottom:10px; color:var(--ink)}
    </style>
</head>
<body>
    <div class="wrap">
        <h1 class="page-title">
            <span>👥</span>
            用戶管理
        </h1>
        
        <!-- 搜索和篩選 -->
        <div class="filters">
            <div class="filter-row">
                <div class="filter-group">
                    <div class="filter-label">搜索</div>
                    <input type="text" class="filter-input" placeholder="用戶名、郵箱..." style="width:200px">
                </div>
                <div class="filter-group">
                    <div class="filter-label">狀態</div>
                    <select class="filter-input" style="width:120px">
                        <option value="">全部</option>
                        <option value="active">活躍</option>
                        <option value="banned">已封禁</option>
                        <option value="pending">待審核</option>
                    </select>
                </div>
                <div class="filter-group">
                    <div class="filter-label">註冊時間</div>
                    <input type="date" class="filter-input" style="width:150px">
                </div>
                <button class="btn btn-primary">搜索</button>
                <button class="btn btn-secondary">重置</button>
            </div>
        </div>
        
        <!-- 用戶表格 -->
        <div class="table-container">
            <table class="table">
                <thead>
                    <tr>
                        <th>用戶ID</th>
                        <th>用戶名</th>
                        <th>郵箱</th>
                        <th>註冊時間</th>
                        <th>最後登入</th>
                        <th>狀態</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model.Any())
                    {
                        @foreach (var user in Model)
                        {
                            <tr>
                                <td>@user.UserId</td>
                                <td>@user.Username</td>
                                <td>@user.Email</td>
                                <td>@user.CreatedAt.ToString("yyyy/MM/dd HH:mm")</td>
                                <td>@(user.LastLoginTime?.ToString("yyyy/MM/dd HH:mm") ?? "從未登入")</td>
                                <td>
                                    @if (user.IsBanned)
                                    {
                                        <span class="status-badge status-banned">已封禁</span>
                                    }
                                    else if (user.EmailConfirmed)
                                    {
                                        <span class="status-badge status-active">活躍</span>
                                    }
                                    else
                                    {
                                        <span class="status-badge status-pending">待驗證</span>
                                    }
                                </td>
                                <td>
                                    <button class="btn btn-secondary" onclick="viewUser(@user.UserId)">查看</button>
                                    <button class="btn btn-primary" onclick="editUser(@user.UserId)">編輯</button>
                                    @if (user.IsBanned)
                                    {
                                        <button class="btn btn-success" onclick="unbanUser(@user.UserId)">解封</button>
                                    }
                                    else
                                    {
                                        <button class="btn btn-danger" onclick="banUser(@user.UserId)">封禁</button>
                                    }
                                </td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="7" class="empty-state">
                                <div class="empty-icon">👥</div>
                                <div class="empty-title">暫無用戶數據</div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
        
        <!-- 分頁 -->
        @if (totalPages > 1)
        {
            <div class="pagination">
                @if (currentPage > 1)
                {
                    <a href="?page=@(currentPage - 1)" class="page-btn">上一頁</a>
                }
                
                @for (int i = Math.Max(1, currentPage - 2); i <= Math.Min(totalPages, currentPage + 2); i++)
                {
                    <a href="?page=@i" class="page-btn @(i == currentPage ? "active" : "")">@i</a>
                }
                
                @if (currentPage < totalPages)
                {
                    <a href="?page=@(currentPage + 1)" class="page-btn">下一頁</a>
                }
            </div>
        }
    </div>

    <script>
        function viewUser(userId) {
            alert('查看用戶 ' + userId + ' 的詳細信息');
        }
        
        function editUser(userId) {
            alert('編輯用戶 ' + userId);
        }
        
        function banUser(userId) {
            if (confirm('確定要封禁用戶 ' + userId + ' 嗎？')) {
                alert('用戶 ' + userId + ' 已被封禁');
            }
        }
        
        function unbanUser(userId) {
            if (confirm('確定要解封用戶 ' + userId + ' 嗎？')) {
                alert('用戶 ' + userId + ' 已被解封');
            }
        }
    </script>
</body>
</html>