@model IEnumerable<GameSpace.Models.Coupon>
@{
    ViewData["Title"] = "æˆ‘çš„å„ªæƒ åˆ¸ - GameSpace";
    Layout = "_Layout";
}

<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>æˆ‘çš„å„ªæƒ åˆ¸ - GameSpace</title>
    <style>
        :root{
            --bg:#eef3f8; --bg2:#ffffff; --ink:#1f2937; --muted:#64748b; --line:#e5e7eb;
            --surface:rgba(255,255,255,.75); --glass:rgba(255,255,255,.45);
            --accent:#7557ff; --accent-2:#34d2ff; --accent-3:#22c55e;
            --radius:18px; --radius-sm:12px; --shadow:0 18px 40px rgba(17,24,39,.12);
            --blur:14px;
        }
        body.dark{
            --bg:#0c111b; --bg2:#0a0f18; --ink:#e5edff; --muted:#9fb1c9; --line:#1e2b43;
            --surface:rgba(22,30,48,.65); --glass:rgba(18,24,39,.50);
            --shadow:0 18px 42px rgba(0,0,0,.35);
        }
        *{box-sizing:border-box} html,body{height:100%}
        body{
            margin:0; color:var(--ink); font:16px/1.65 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans TC","PingFang TC","Microsoft JhengHei",sans-serif;
            background:
                radial-gradient(900px 500px at -10% -10%, rgba(117,87,255,.10), transparent 60%),
                radial-gradient(800px 460px at 110% 10%, rgba(52,210,255,.10), transparent 50%),
                linear-gradient(180deg, var(--bg), var(--bg2));
        }
        .wrap{max-width:1200px; margin:0 auto; padding:0 16px}
        
        /* æ¨™é¡Œ */
        .page-title{
            font-size:32px; font-weight:900; color:var(--ink); margin:40px 0 30px; text-align:center;
        }
        
        /* å„ªæƒ åˆ¸å¡ç‰‡ */
        .coupon-card{
            background:var(--glass); border:1px solid var(--line); border-radius:20px; 
            padding:30px; backdrop-filter:blur(var(--blur)); box-shadow:var(--shadow);
            margin:20px 0; position:relative; overflow:hidden;
        }
        .coupon-card.used{
            opacity:0.6; background:var(--surface);
        }
        .coupon-card.expired{
            opacity:0.4; background:var(--surface);
        }
        
        /* å„ªæƒ åˆ¸ä»£ç¢¼ */
        .coupon-code{
            font-size:24px; font-weight:900; color:var(--accent); margin-bottom:15px;
            font-family: 'Courier New', monospace; letter-spacing:2px;
        }
        
        /* å„ªæƒ åˆ¸é¡å‹ */
        .coupon-type{
            font-size:20px; font-weight:700; color:var(--ink); margin-bottom:10px;
        }
        
        /* æŠ˜æ‰£ä¿¡æ¯ */
        .discount-info{
            display:flex; align-items:center; gap:15px; margin:15px 0;
        }
        .discount-value{
            font-size:28px; font-weight:900; color:var(--accent-3);
        }
        .discount-type{
            font-size:16px; color:var(--muted);
        }
        
        /* ä½¿ç”¨æ¢ä»¶ */
        .usage-conditions{
            background:var(--surface); border-radius:12px; padding:15px; margin:15px 0;
        }
        .condition-item{
            display:flex; justify-content:space-between; margin:8px 0; font-size:14px;
        }
        .condition-label{color:var(--muted)}
        .condition-value{color:var(--ink); font-weight:600}
        
        /* ç‹€æ…‹æ¨™ç±¤ */
        .status-badge{
            position:absolute; top:20px; right:20px; padding:8px 16px; border-radius:20px;
            font-size:12px; font-weight:700; text-transform:uppercase;
        }
        .status-badge.available{
            background:var(--accent-3); color:#fff;
        }
        .status-badge.used{
            background:#6b7280; color:#fff;
        }
        .status-badge.expired{
            background:#ef4444; color:#fff;
        }
        
        /* æ™‚é–“ä¿¡æ¯ */
        .time-info{
            display:flex; justify-content:space-between; margin-top:20px; padding-top:20px;
            border-top:1px solid var(--line); font-size:14px; color:var(--muted);
        }
        
        /* ç©ºç‹€æ…‹ */
        .empty-state{
            text-align:center; padding:80px 20px; color:var(--muted);
        }
        .empty-icon{font-size:64px; margin-bottom:20px}
        .empty-title{font-size:24px; font-weight:700; margin-bottom:10px; color:var(--ink)}
        .empty-desc{font-size:16px}
        
        /* æ“ä½œæŒ‰éˆ• */
        .action-buttons{
            display:flex; gap:10px; margin-top:20px;
        }
        .btn{
            padding:12px 24px; border:none; border-radius:12px; font-weight:700;
            cursor:pointer; transition:all 0.3s ease; text-decoration:none; display:inline-block;
        }
        .btn-primary{
            background:var(--accent); color:#fff;
        }
        .btn-primary:hover{background:#6d28d9; transform:translateY(-2px)}
        .btn-secondary{
            background:var(--surface); color:var(--ink); border:1px solid var(--line);
        }
        .btn-secondary:hover{background:var(--line)}
        .btn:disabled{
            opacity:0.5; cursor:not-allowed; transform:none;
        }
    </style>
</head>
<body>
    <div class="wrap">
        <h1 class="page-title">ğŸ« æˆ‘çš„å„ªæƒ åˆ¸</h1>
        
        @if (Model.Any())
        {
            @foreach (var coupon in Model)
            {
                var isExpired = coupon.CouponType.ValidTo < DateTime.Now;
                var isUsed = coupon.IsUsed;
                var statusClass = isUsed ? "used" : (isExpired ? "expired" : "");
                var statusText = isUsed ? "å·²ä½¿ç”¨" : (isExpired ? "å·²éæœŸ" : "å¯ä½¿ç”¨");
                var statusBadgeClass = isUsed ? "used" : (isExpired ? "expired" : "available");
                
                <div class="coupon-card @statusClass">
                    <div class="status-badge @statusBadgeClass">@statusText</div>
                    
                    <div class="coupon-code">@coupon.CouponCode</div>
                    <div class="coupon-type">@coupon.CouponType.TypeName</div>
                    
                    @if (!string.IsNullOrEmpty(coupon.CouponType.Description))
                    {
                        <div style="color:var(--muted); margin-bottom:15px;">@coupon.CouponType.Description</div>
                    }
                    
                    <div class="discount-info">
                        <div class="discount-value">
                            @if (coupon.CouponType.DiscountType == "Percentage")
                            {
                                @($"{coupon.CouponType.DiscountValue}%")
                            }
                            else
                            {
                                @($"NT$ {coupon.CouponType.DiscountValue:N0}")
                            }
                        </div>
                        <div class="discount-type">
                            @(coupon.CouponType.DiscountType == "Percentage" ? "æŠ˜æ‰£" : "æŠ˜æŠµ")
                        </div>
                    </div>
                    
                    <div class="usage-conditions">
                        @if (coupon.CouponType.MinOrderAmount.HasValue)
                        {
                            <div class="condition-item">
                                <span class="condition-label">æœ€ä½æ¶ˆè²»</span>
                                <span class="condition-value">NT$ @coupon.CouponType.MinOrderAmount.Value:N0</span>
                            </div>
                        }
                        @if (coupon.CouponType.MaxDiscountAmount.HasValue)
                        {
                            <div class="condition-item">
                                <span class="condition-label">æœ€é«˜æŠ˜æŠµ</span>
                                <span class="condition-value">NT$ @coupon.CouponType.MaxDiscountAmount.Value:N0</span>
                            </div>
                        }
                        <div class="condition-item">
                            <span class="condition-label">æœ‰æ•ˆæœŸé™</span>
                            <span class="condition-value">@coupon.CouponType.ValidTo.ToString("yyyy/MM/dd")</span>
                        </div>
                    </div>
                    
                    <div class="time-info">
                        <div>ç²å¾—æ™‚é–“: @coupon.AcquiredTime.ToString("yyyy/MM/dd HH:mm")</div>
                        @if (coupon.UsedTime.HasValue)
                        {
                            <div>ä½¿ç”¨æ™‚é–“: @coupon.UsedTime.Value.ToString("yyyy/MM/dd HH:mm")</div>
                        }
                    </div>
                    
                    @if (!isUsed && !isExpired)
                    {
                        <div class="action-buttons">
                            <button class="btn btn-primary" onclick="useCoupon(@coupon.CouponId)">
                                ç«‹å³ä½¿ç”¨
                            </button>
                            <button class="btn btn-secondary" onclick="copyCouponCode('@coupon.CouponCode')">
                                è¤‡è£½ä»£ç¢¼
                            </button>
                        </div>
                    }
                </div>
            }
        }
        else
        {
            <div class="empty-state">
                <div class="empty-icon">ğŸ«</div>
                <div class="empty-title">æš«ç„¡å„ªæƒ åˆ¸</div>
                <div class="empty-desc">æ‚¨é‚„æ²’æœ‰ä»»ä½•å„ªæƒ åˆ¸ï¼Œå¿«å»åƒåŠ æ´»å‹•ç²å¾—å§ï¼</div>
            </div>
        }
    </div>

    <script>
        function useCoupon(couponId) {
            if (confirm('ç¢ºå®šè¦ä½¿ç”¨é€™å¼µå„ªæƒ åˆ¸å—ï¼Ÿ')) {
                // é€™è£¡æ‡‰è©²è·³è½‰åˆ°çµå¸³é é¢æˆ–è™•ç†ä½¿ç”¨é‚è¼¯
                alert('å„ªæƒ åˆ¸ä½¿ç”¨åŠŸèƒ½é–‹ç™¼ä¸­...');
            }
        }
        
        function copyCouponCode(code) {
            navigator.clipboard.writeText(code).then(function() {
                alert('å„ªæƒ åˆ¸ä»£ç¢¼å·²è¤‡è£½åˆ°å‰ªè²¼æ¿ï¼');
            }, function(err) {
                console.error('è¤‡è£½å¤±æ•—: ', err);
                alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½ï¼š' + code);
            });
        }
    </script>
</body>
</html>