@model CheckoutViewModel
@{
    ViewData["Title"] = "Ë≥ºÁâ©Ëªä - GameSpace";
    Layout = "_Layout";
}

<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Ë≥ºÁâ©Ëªä - GameSpace</title>
    <style>
        :root{
            --bg:#eef3f8; --bg2:#ffffff; --ink:#1f2937; --muted:#64748b; --line:#e5e7eb;
            --surface:rgba(255,255,255,.75); --glass:rgba(255,255,255,.45);
            --accent:#7557ff; --accent-2:#34d2ff; --accent-3:#22c55e;
            --radius:18px; --radius-sm:12px; --shadow:0 18px 40px rgba(17,24,39,.12);
            --blur:14px;
        }
        body.dark{
            --bg:#0c111b; --bg2:#0a0f18; --ink:#e5edff; --muted:#9fb1c9; --line:#1e2b43;
            --surface:rgba(22,30,48,.65); --glass:rgba(18,24,39,.50);
            --shadow:0 18px 42px rgba(0,0,0,.35);
        }
        *{box-sizing:border-box} html,body{height:100%}
        body{
            margin:0; color:var(--ink); font:16px/1.65 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans TC","PingFang TC","Microsoft JhengHei",sans-serif;
            background:
                radial-gradient(900px 500px at -10% -10%, rgba(117,87,255,.10), transparent 60%),
                radial-gradient(800px 460px at 110% 10%, rgba(52,210,255,.10), transparent 50%),
                linear-gradient(180deg, var(--bg), var(--bg2));
        }
        .wrap{max-width:1000px; margin:0 auto; padding:0 16px}
        
        /* Ë≥ºÁâ©ËªäÂÆπÂô® */
        .cart-container{
            background:var(--glass); border:1px solid var(--line); border-radius:20px; 
            padding:40px; backdrop-filter:blur(var(--blur)); box-shadow:var(--shadow);
            margin:30px 0;
        }
        
        .cart-header{
            display:flex; justify-content:space-between; align-items:center; margin-bottom:30px;
            padding-bottom:20px; border-bottom:2px solid var(--line);
        }
        .cart-title{font-size:28px; font-weight:900; color:var(--ink); margin:0}
        .cart-count{background:var(--accent); color:#fff; padding:8px 16px; border-radius:20px; font-weight:700}
        
        /* Ë≥ºÁâ©ËªäÈ†ÖÁõÆ */
        .cart-items{display:grid; gap:20px; margin-bottom:30px}
        .cart-item{
            background:var(--surface); border:1px solid var(--line); border-radius:15px;
            padding:20px; display:grid; grid-template-columns:80px 1fr auto auto; gap:20px;
            align-items:center; transition:all 0.3s ease;
        }
        .cart-item:hover{transform:translateY(-2px); box-shadow:0 8px 25px rgba(0,0,0,0.1)}
        
        .item-image{
            width:80px; height:80px; border-radius:12px; background:linear-gradient(135deg,var(--accent),var(--accent-2));
            display:flex; align-items:center; justify-content:center; font-size:32px; color:#fff;
        }
        
        .item-info h3{font-size:18px; font-weight:700; color:var(--ink); margin:0 0 8px 0}
        .item-info p{color:var(--muted); font-size:14px; margin:0}
        
        .item-price{font-size:20px; font-weight:900; color:var(--accent); text-align:center}
        
        .item-actions{display:flex; align-items:center; gap:15px}
        .quantity-controls{
            display:flex; align-items:center; gap:10px; background:var(--surface); border-radius:12px; padding:5px;
        }
        .quantity-btn{
            width:32px; height:32px; border:none; border-radius:8px; background:var(--accent); color:#fff;
            font-weight:700; cursor:pointer; transition:all 0.3s ease;
        }
        .quantity-btn:hover{background:var(--accent-2)}
        .quantity-input{
            width:50px; text-align:center; border:none; background:transparent; color:var(--ink);
            font-size:16px; font-weight:700;
        }
        .remove-btn{
            background:#ef4444; color:#fff; border:none; padding:8px 12px; border-radius:8px;
            font-weight:700; cursor:pointer; transition:all 0.3s ease;
        }
        .remove-btn:hover{background:#dc2626}
        
        /* Ë≥ºÁâ©ËªäÊëòË¶Å */
        .cart-summary{
            background:var(--surface); border:1px solid var(--line); border-radius:15px;
            padding:25px; margin-top:30px;
        }
        .summary-row{
            display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;
        }
        .summary-label{font-weight:700; color:var(--ink)}
        .summary-value{font-weight:700; color:var(--accent); font-size:18px}
        .summary-total{
            border-top:2px solid var(--line); padding-top:15px; margin-top:15px;
        }
        .summary-total .summary-label{font-size:20px}
        .summary-total .summary-value{font-size:24px}
        
        /* ÁµêÂ∏≥Ë°®ÂñÆ */
        .checkout-form{
            background:var(--surface); border:1px solid var(--line); border-radius:15px;
            padding:25px; margin-top:20px;
        }
        .form-group{margin-bottom:20px}
        .form-label{display:block; font-weight:700; color:var(--ink); margin-bottom:8px}
        .form-input{
            width:100%; padding:12px; border:2px solid var(--line); border-radius:8px;
            background:var(--surface); color:var(--ink); font-size:16px;
        }
        .form-input:focus{outline:none; border-color:var(--accent)}
        
        .checkout-btn{
            width:100%; background:linear-gradient(135deg,var(--accent),#3b82f6); color:#fff;
            border:none; padding:18px; border-radius:12px; font-weight:700; cursor:pointer;
            transition:all 0.3s ease; box-shadow:var(--shadow); font-size:18px;
        }
        .checkout-btn:hover{transform:translateY(-2px); box-shadow:0 8px 25px rgba(117,87,255,0.4)}
        
        /* Á©∫ÁãÄÊÖã */
        .empty-cart{text-align:center; padding:60px 20px; color:var(--muted)}
        .empty-icon{font-size:64px; margin-bottom:20px}
        .empty-title{font-size:24px; font-weight:700; margin-bottom:10px; color:var(--ink)}
        .empty-desc{font-size:16px; margin-bottom:30px}
        .shop-btn{
            background:linear-gradient(135deg,var(--accent),#3b82f6); color:#fff;
            padding:15px 30px; border-radius:12px; text-decoration:none; font-weight:700;
            display:inline-block; transition:all 0.3s ease;
        }
        .shop-btn:hover{transform:translateY(-2px); box-shadow:0 8px 25px rgba(117,87,255,0.4)}
    </style>
</head>
<body>
    <div class="wrap">
        <div class="cart-container">
            <div class="cart-header">
                <h1 class="cart-title">üõí Ë≥ºÁâ©Ëªä</h1>
                <div class="cart-count" id="cartCount">0 ‰ª∂ÂïÜÂìÅ</div>
            </div>
            
            <div id="cartContent">
                @if (Model.Items.Any())
                {
                    <div class="cart-items" id="cartItems">
                        @foreach (var item in Model.Items)
                        {
                            <div class="cart-item" data-product-id="@item.ProductId">
                                <div class="item-image">üéÆ</div>
                                <div class="item-info">
                                    <h3>@item.ProductName</h3>
                                    <p>ÂñÆÂÉπ: NT$ @item.UnitPrice.ToString("N0")</p>
                                </div>
                                <div class="item-price">NT$ @((item.UnitPrice * item.Quantity).ToString("N0"))</div>
                                <div class="item-actions">
                                    <div class="quantity-controls">
                                        <button class="quantity-btn" onclick="changeQuantity(@item.ProductId, -1)">-</button>
                                        <input type="number" class="quantity-input" value="@item.Quantity" min="1" data-product-id="@item.ProductId">
                                        <button class="quantity-btn" onclick="changeQuantity(@item.ProductId, 1)">+</button>
                                    </div>
                                    <button class="remove-btn" onclick="removeItem(@item.ProductId)">ÁßªÈô§</button>
                                </div>
                            </div>
                        }
                    </div>
                    
                    <div class="cart-summary">
                        <div class="summary-row">
                            <span class="summary-label">Â∞èË®à</span>
                            <span class="summary-value" id="subtotal">NT$ @Model.TotalAmount.ToString("N0")</span>
                        </div>
                        <div class="summary-row">
                            <span class="summary-label">ÈÅãË≤ª</span>
                            <span class="summary-value">NT$ 0</span>
                        </div>
                        <div class="summary-row summary-total">
                            <span class="summary-label">Á∏ΩË®à</span>
                            <span class="summary-value" id="total">NT$ @Model.TotalAmount.ToString("N0")</span>
                        </div>
                    </div>
                    
                    <form asp-action="Checkout" method="post" class="checkout-form">
                        @Html.AntiForgeryToken()
                        <div class="form-group">
                            <label class="form-label" for="shippingAddress">Êî∂Ë≤®Âú∞ÂùÄ</label>
                            <input type="text" id="shippingAddress" name="ShippingAddress" class="form-input" 
                                   value="@Model.ShippingAddress" placeholder="Ë´ãËº∏ÂÖ•Êî∂Ë≤®Âú∞ÂùÄ" required>
                        </div>
                        <input type="hidden" name="TotalAmount" id="totalAmount" value="@Model.TotalAmount">
                        <input type="hidden" name="Items" id="itemsJson" value="@Json.Serialize(Model.Items)">
                        <button type="submit" class="checkout-btn">Á´ãÂç≥ÁµêÂ∏≥</button>
                    </form>
                }
                else
                {
                    <div class="empty-cart">
                        <div class="empty-icon">üõí</div>
                        <div class="empty-title">Ë≥ºÁâ©ËªäÊòØÁ©∫ÁöÑ</div>
                        <div class="empty-desc">Âø´ÂéªÂïÜÂüéÈÅ∏Ë≥º‰Ω†ÂñúÊ≠°ÁöÑÂïÜÂìÅÂêßÔºÅ</div>
                        <a href="/Shop" class="shop-btn">ÂâçÂæÄÂïÜÂüé</a>
                    </div>
                }
            </div>
        </div>
    </div>

    <script>
        function changeQuantity(productId, delta) {
            const input = document.querySelector(`input[data-product-id="${productId}"]`);
            const currentValue = parseInt(input.value);
            const newValue = Math.max(1, currentValue + delta);
            input.value = newValue;
            updateCart();
        }
        
        function removeItem(productId) {
            if (confirm('Á¢∫ÂÆöË¶ÅÁßªÈô§Ê≠§ÂïÜÂìÅÂóéÔºü')) {
                const item = document.querySelector(`[data-product-id="${productId}"]`);
                item.remove();
                updateCart();
            }
        }
        
        function updateCart() {
            const items = [];
            const cartItems = document.querySelectorAll('.cart-item');
            let total = 0;
            
            cartItems.forEach(item => {
                const productId = parseInt(item.dataset.productId);
                const quantity = parseInt(item.querySelector('.quantity-input').value);
                const unitPrice = parseFloat(item.querySelector('.item-price').textContent.replace('NT$ ', '').replace(',', ''));
                const subtotal = unitPrice / quantity * quantity;
                
                items.push({
                    ProductId: productId,
                    Quantity: quantity,
                    UnitPrice: unitPrice / quantity
                });
                
                total += subtotal;
            });
            
            document.getElementById('subtotal').textContent = `NT$ ${total.toLocaleString()}`;
            document.getElementById('total').textContent = `NT$ ${total.toLocaleString()}`;
            document.getElementById('totalAmount').value = total;
            document.getElementById('itemsJson').value = JSON.stringify(items);
            document.getElementById('cartCount').textContent = `${items.length} ‰ª∂ÂïÜÂìÅ`;
        }
        
        // ÂàùÂßãÂåñË≥ºÁâ©Ëªä
        document.addEventListener('DOMContentLoaded', function() {
            updateCart();
        });
    </script>
</body>
</html>