@model List<OrderInfo>
@{
    ViewData["Title"] = "我的訂單 - GameSpace";
    Layout = "_Layout";
}

<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>我的訂單 - GameSpace</title>
    <style>
        :root{
            --bg:#eef3f8; --bg2:#ffffff; --ink:#1f2937; --muted:#64748b; --line:#e5e7eb;
            --surface:rgba(255,255,255,.75); --glass:rgba(255,255,255,.45);
            --accent:#7557ff; --accent-2:#34d2ff; --accent-3:#22c55e;
            --radius:18px; --radius-sm:12px; --shadow:0 18px 40px rgba(17,24,39,.12);
            --blur:14px;
        }
        body.dark{
            --bg:#0c111b; --bg2:#0a0f18; --ink:#e5edff; --muted:#9fb1c9; --line:#1e2b43;
            --surface:rgba(22,30,48,.65); --glass:rgba(18,24,39,.50);
            --shadow:0 18px 42px rgba(0,0,0,.35);
        }
        *{box-sizing:border-box} html,body{height:100%}
        body{
            margin:0; color:var(--ink); font:16px/1.65 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans TC","PingFang TC","Microsoft JhengHei",sans-serif;
            background:
                radial-gradient(900px 500px at -10% -10%, rgba(117,87,255,.10), transparent 60%),
                radial-gradient(800px 460px at 110% 10%, rgba(52,210,255,.10), transparent 50%),
                linear-gradient(180deg, var(--bg), var(--bg2));
        }
        .wrap{max-width:1000px; margin:0 auto; padding:0 16px}
        
        /* 訂單列表容器 */
        .orders-container{
            background:var(--glass); border:1px solid var(--line); border-radius:20px; 
            padding:40px; backdrop-filter:blur(var(--blur)); box-shadow:var(--shadow);
            margin:30px 0;
        }
        
        .orders-header{
            display:flex; justify-content:space-between; align-items:center; margin-bottom:30px;
            padding-bottom:20px; border-bottom:2px solid var(--line);
        }
        .orders-title{font-size:28px; font-weight:900; color:var(--ink); margin:0}
        .orders-count{background:var(--accent); color:#fff; padding:8px 16px; border-radius:20px; font-weight:700}
        
        /* 訂單項目 */
        .orders-list{display:grid; gap:20px}
        .order-item{
            background:var(--surface); border:1px solid var(--line); border-radius:15px;
            padding:25px; transition:all 0.3s ease; cursor:pointer;
        }
        .order-item:hover{transform:translateY(-2px); box-shadow:0 8px 25px rgba(0,0,0,0.1)}
        
        .order-header{
            display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;
        }
        .order-info h3{font-size:20px; font-weight:700; color:var(--ink); margin:0 0 8px 0}
        .order-info p{color:var(--muted); font-size:14px; margin:0}
        .order-status{
            padding:8px 16px; border-radius:20px; font-weight:700; font-size:14px;
        }
        .status-pending{background:#fef3c7; color:#92400e}
        .status-paid{background:#d1fae5; color:#065f46}
        .status-shipped{background:#dbeafe; color:#1e40af}
        .status-completed{background:#e5e7eb; color:#374151}
        .status-cancelled{background:#fee2e2; color:#991b1b}
        
        .order-details{
            display:grid; grid-template-columns:1fr 1fr; gap:20px; margin-bottom:20px;
        }
        .detail-group h4{font-size:16px; font-weight:700; color:var(--ink); margin:0 0 8px 0}
        .detail-group p{color:var(--muted); font-size:14px; margin:0}
        
        .order-items{
            background:var(--glass); border:1px solid var(--line); border-radius:12px;
            padding:20px; margin-bottom:20px;
        }
        .items-title{font-size:16px; font-weight:700; color:var(--ink); margin:0 0 15px 0}
        .item-list{display:grid; gap:10px}
        .item-row{
            display:grid; grid-template-columns:1fr auto auto; gap:15px; align-items:center;
            padding:10px; background:var(--surface); border-radius:8px;
        }
        .item-name{font-weight:700; color:var(--ink)}
        .item-quantity{color:var(--muted); text-align:center}
        .item-price{font-weight:700; color:var(--accent); text-align:right}
        
        .order-total{
            display:flex; justify-content:space-between; align-items:center;
            padding:15px; background:var(--accent); color:#fff; border-radius:12px;
            font-size:18px; font-weight:700;
        }
        
        .order-actions{
            display:flex; gap:10px; justify-content:flex-end;
        }
        .action-btn{
            padding:8px 16px; border-radius:8px; font-weight:700; cursor:pointer;
            transition:all 0.3s ease; text-decoration:none; display:inline-block;
        }
        .btn-primary{
            background:linear-gradient(135deg,var(--accent),#3b82f6); color:#fff;
        }
        .btn-primary:hover{transform:translateY(-2px); box-shadow:0 8px 25px rgba(117,87,255,0.4)}
        .btn-secondary{
            background:var(--surface); color:var(--ink); border:2px solid var(--line);
        }
        .btn-secondary:hover{background:var(--line)}
        
        /* 空狀態 */
        .empty-orders{text-align:center; padding:60px 20px; color:var(--muted)}
        .empty-icon{font-size:64px; margin-bottom:20px}
        .empty-title{font-size:24px; font-weight:700; margin-bottom:10px; color:var(--ink)}
        .empty-desc{font-size:16px; margin-bottom:30px}
        .shop-btn{
            background:linear-gradient(135deg,var(--accent),#3b82f6); color:#fff;
            padding:15px 30px; border-radius:12px; text-decoration:none; font-weight:700;
            display:inline-block; transition:all 0.3s ease;
        }
        .shop-btn:hover{transform:translateY(-2px); box-shadow:0 8px 25px rgba(117,87,255,0.4)}
    </style>
</head>
<body>
    <div class="wrap">
        <div class="orders-container">
            <div class="orders-header">
                <h1 class="orders-title">📦 我的訂單</h1>
                <div class="orders-count">@Model.Count 筆訂單</div>
            </div>
            
            @if (Model.Any())
            {
                <div class="orders-list">
                    @foreach (var order in Model)
                    {
                        <div class="order-item" onclick="toggleOrderDetails(@order.OrderId)">
                            <div class="order-header">
                                <div class="order-info">
                                    <h3>訂單 #@order.OrderCode</h3>
                                    <p>下單時間: @order.CreatedAt.ToString("yyyy/MM/dd HH:mm")</p>
                                </div>
                                <div class="order-status status-@order.OrderStatus.ToLower()">
                                    @GetStatusText(order.OrderStatus)
                                </div>
                            </div>
                            
                            <div class="order-details">
                                <div class="detail-group">
                                    <h4>訂單狀態</h4>
                                    <p>@GetStatusText(order.OrderStatus)</p>
                                </div>
                                <div class="detail-group">
                                    <h4>付款狀態</h4>
                                    <p>@(order.Paid ? "已付款" : "未付款")</p>
                                </div>
                                <div class="detail-group">
                                    <h4>配送狀態</h4>
                                    <p>@(order.Shipped ? "已出貨" : "未出貨")</p>
                                </div>
                                <div class="detail-group">
                                    <h4>完成狀態</h4>
                                    <p>@(order.Completed ? "已完成" : "進行中")</p>
                                </div>
                            </div>
                            
                            <div class="order-items" id="orderItems_@order.OrderId" style="display:none">
                                <h4 class="items-title">訂單商品</h4>
                                <div class="item-list">
                                    @foreach (var item in order.OrderItems)
                                    {
                                        <div class="item-row">
                                            <div class="item-name">@item.Product.ProductName</div>
                                            <div class="item-quantity">x @item.Quantity</div>
                                            <div class="item-price">NT$ @((item.UnitPrice * item.Quantity).ToString("N0"))</div>
                                        </div>
                                    }
                                </div>
                            </div>
                            
                            <div class="order-total">
                                <span>訂單總額</span>
                                <span>NT$ @order.OrderTotal.ToString("N0")</span>
                            </div>
                            
                            <div class="order-actions">
                                <a href="/Shop/OrderSuccess/@order.OrderId" class="action-btn btn-primary">查看詳情</a>
                                @if (order.OrderStatus == "待付款")
                                {
                                    <button class="action-btn btn-secondary" onclick="payOrder(@order.OrderId)">立即付款</button>
                                }
                            </div>
                        </div>
                    }
                </div>
            }
            else
            {
                <div class="empty-orders">
                    <div class="empty-icon">📦</div>
                    <div class="empty-title">暫無訂單</div>
                    <div class="empty-desc">快去商城選購你喜歡的商品吧！</div>
                    <a href="/Shop" class="shop-btn">前往商城</a>
                </div>
            }
        </div>
    </div>

    <script>
        function toggleOrderDetails(orderId) {
            const items = document.getElementById(`orderItems_${orderId}`);
            if (items.style.display === 'none') {
                items.style.display = 'block';
            } else {
                items.style.display = 'none';
            }
        }
        
        function payOrder(orderId) {
            if (confirm('確定要付款此訂單嗎？')) {
                // 這裡可以實現付款邏輯
                alert('付款功能開發中...');
            }
        }
    </script>
</body>
</html>

@functions {
    private string GetStatusText(string status)
    {
        return status switch
        {
            "待付款" => "待付款",
            "已付款" => "已付款",
            "已出貨" => "已出貨",
            "已完成" => "已完成",
            "已取消" => "已取消",
            _ => status
        };
    }
}